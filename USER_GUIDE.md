# คู่มือการใช้งานระบบควบคุม ESP32

คู่มือนี้จะอธิบายวิธีการใช้งานระบบควบคุม ESP32 ที่ปรับปรุงใหม่ ซึ่งรองรับการแสดงสถานะ input ทั้งหมด, ระบบตั้งเวลาที่ใช้งานง่าย และแสดงแผงควบคุมเป็น 2 คอลัมน์

## สารบัญ
1. [การเข้าใช้งานระบบ](#การเข้าใช้งานระบบ)
2. [ส่วนประกอบของหน้าจอ](#ส่วนประกอบของหน้าจอ)
3. [การดูสถานะเซ็นเซอร์](#การดูสถานะเซ็นเซอร์)
4. [การควบคุมรีเลย์](#การควบคุมรีเลย์)
5. [การตั้งเวลา](#การตั้งเวลา)
6. [การแก้ไขปัญหา](#การแก้ไขปัญหา)

## การเข้าใช้งานระบบ

1. เปิดไฟล์ `web/index.html` ในเว็บเบราว์เซอร์
2. ระบบจะเชื่อมต่อกับ MQTT broker อัตโนมัติ
3. รอสักครู่เพื่อให้ระบบเชื่อมต่อกับอุปกรณ์ ESP32
4. สถานะการเชื่อมต่อจะแสดงที่มุมขวาบนของแต่ละอุปกรณ์

## ส่วนประกอบของหน้าจอ

หน้าจอหลักแบ่งออกเป็นส่วนต่างๆ ดังนี้:

### 1. แถบนำทาง (Navigation Bar)
- อยู่ด้านบนสุดของหน้าจอ
- แสดงชื่อระบบและเมนูต่างๆ

### 2. ส่วนควบคุม ESP32 แต่ละตัว
- แต่ละ ESP32 จะมีส่วนควบคุมแยกกัน
- แสดงสถานะการเชื่อมต่อที่มุมขวาบน (ออนไลน์/ออฟไลน์)

### 3. ส่วนแสดงสถานะเซ็นเซอร์
- แสดงค่าจากเซ็นเซอร์ต่างๆ ที่เชื่อมต่อกับ ESP32
- แสดงเป็นการ์ดแยกตามประเภทเซ็นเซอร์

### 4. ส่วนควบคุมรีเลย์
- แสดงเป็น 2 คอลัมน์
- แต่ละรีเลย์มีปุ่มควบคุมและส่วนตั้งเวลาแยกกัน

## การดูสถานะเซ็นเซอร์

ระบบรองรับการแสดงสถานะเซ็นเซอร์ 5 ประเภท:

### 1. อัตราการไหลของน้ำ
- แสดงในหน่วยลิตร/นาที
- อัปเดตอัตโนมัติทุก 5 วินาที

### 2. ความชื้นในดิน
- แสดงในหน่วยเปอร์เซ็นต์ (0-100%)
- ค่ายิ่งสูงแสดงว่าดินมีความชื้นมาก

### 3. อุณหภูมิ
- แสดงในหน่วยองศาเซลเซียส
- แสดงทศนิยม 1 ตำแหน่ง

### 4. ระดับน้ำ
- แสดงในหน่วยเปอร์เซ็นต์ (0-100%)
- ค่ายิ่งสูงแสดงว่าระดับน้ำสูง

### 5. ระดับแสง
- แสดงในหน่วยเปอร์เซ็นต์ (0-100%)
- ค่ายิ่งสูงแสดงว่ามีแสงมาก

## การควบคุมรีเลย์

แต่ละรีเลย์มีปุ่มควบคุม 2 ปุ่ม:

- **ปุ่มเปิด (สีเขียว)**: กดเพื่อเปิดรีเลย์ทันที
- **ปุ่มปิด (สีแดง)**: กดเพื่อปิดรีเลย์ทันที

สถานะปัจจุบันของรีเลย์จะแสดงด้านล่างปุ่มควบคุม:
- **เปิด (สีเขียว)**: รีเลย์กำลังทำงาน
- **ปิด (สีแดง)**: รีเลย์ไม่ทำงาน

## การตั้งเวลา

ระบบตั้งเวลาใหม่รองรับการตั้งเวลาหลายรายการพร้อมกันและมีตัวเลือกหน่วยเวลา:

### การตั้งเวลา
1. ป้อนระยะเวลาที่ต้องการในช่อง "ระยะเวลา"
2. เลือกหน่วยเวลาจากตัวเลือก:
   - วินาที
   - นาที
   - ชั่วโมง
3. กดปุ่ม "ตั้งเวลาเปิด" หรือ "ตั้งเวลาปิด" ตามต้องการ
4. รายการตั้งเวลาจะปรากฏในตารางด้านล่าง

### การดูรายการตั้งเวลา
ตารางการตั้งเวลาจะแสดงข้อมูลต่อไปนี้:
- **การทำงาน**: เปิดหรือปิด
- **เวลาที่เหลือ**: เวลาที่เหลือก่อนที่การตั้งเวลาจะทำงาน
- **จัดการ**: ปุ่มสำหรับยกเลิกการตั้งเวลาเฉพาะรายการ

### การยกเลิกการตั้งเวลา
- **ยกเลิกเฉพาะรายการ**: กดปุ่ม "ยกเลิก" ในตารางการตั้งเวลา
- **ยกเลิกทั้งหมด**: กดปุ่ม "ยกเลิกการตั้งเวลา" ด้านบนตาราง

## การแก้ไขปัญหา

### 1. ไม่สามารถเชื่อมต่อกับ ESP32 ได้
- ตรวจสอบว่า ESP32 เปิดอยู่และเชื่อมต่อกับเครือข่าย WiFi
- ตรวจสอบว่า MQTT broker ทำงานอยู่
- รีเฟรชหน้าเว็บและรอสักครู่

### 2. ไม่เห็นข้อมูลเซ็นเซอร์
- ตรวจสอบว่าเซ็นเซอร์เชื่อมต่อกับ ESP32 อย่างถูกต้อง
- ตรวจสอบว่า ESP32 ออนไลน์อยู่ (สถานะการเชื่อมต่อเป็น "ออนไลน์")
- ตรวจสอบการกำหนด GPIO ในโค้ด Rust ว่าตรงกับการเชื่อมต่อจริง

### 3. การตั้งเวลาไม่ทำงาน
- ตรวจสอบว่าป้อนระยะเวลาเป็นตัวเลขที่มากกว่า 0
- ตรวจสอบว่า ESP32 ออนไลน์อยู่
- ลองยกเลิกการตั้งเวลาทั้งหมดและตั้งใหม่

### 4. รีเลย์ไม่ตอบสนองต่อคำสั่ง
- ตรวจสอบว่า ESP32 ออนไลน์อยู่
- ตรวจสอบการเชื่อมต่อของรีเลย์กับ ESP32
- ตรวจสอบการกำหนด GPIO ในโค้ด Rust ว่าตรงกับการเชื่อมต่อจริง

### 5. หน้าเว็บแสดงผลไม่ถูกต้อง
- ลองรีเฟรชหน้าเว็บ
- ลองใช้เบราว์เซอร์อื่น (แนะนำ Chrome หรือ Firefox เวอร์ชันล่าสุด)
- ตรวจสอบว่าเปิดใช้งาน JavaScript ในเบราว์เซอร์

